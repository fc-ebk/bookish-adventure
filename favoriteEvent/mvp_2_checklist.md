# 홈 개인화 — 찜 정모 기반 (A/B 단일 노출 정책) 개발 체크리스트

> 2차(W04): 홈 개인화 섹션 개발

홈 화면에서 찜 정모를 활용한 개인화 노출을 구현할 때 **A 섹션 또는 B 섹션 중 최대 1개만 노출**되도록 하기 위한 모든 분기·예외·금지 조건을 상세 TODO로 정리한 문서이다.

---

## 0. 전제 및 공통 원칙

- 홈에서 찜 정모 개인화 섹션은 **0 또는 1개만 노출**
- 개인화 섹션 종류
  - A. 곧 시작하는 찜한 정모 (시간 임박, 리스트형)
  - B. 같은 모임의 다른 정모 (마감 대체, 로테이션)
- 우선순위는 **A > B**
- 조건 불충족 시 아무 섹션도 노출하지 않음

---

## 1. 섹션 선택 분기 (최상위 로직)

- A 섹션 조건 충족 여부 판단
  - 충족 → A만 노출
- A 미충족 시 B 섹션 조건 판단
  - 충족 → B 노출
- A, B 모두 미충족
  - 개인화 섹션 전체 미노출

```pseudo
if (A 조건 충족):
    show A
else if (B 조건 충족):
    show B
else:
    show none
```

### 예상 UI
> none, section A, section B

<p float="left">
  <img src="../assets/mvp2/home-none.JPG" width="30%" />
  <img src="../assets/mvp2/home-section-a.jpg" width="30%" />
  <img src="../assets/mvp2/home-section-b-list.jpg" width="30%" />
</p>

---

## 2. A 섹션 — 곧 시작하는 찜한 정모 (리스트)

### 2.1 노출 조건 판단

- [ ] 사용자 찜한 정모 목록 조회
- [ ] 시작일 기준 D-3 이내 정모 존재 여부 확인
  - [ ] 존재 → A 조건 충족
  - [ ] 없음 → A 조건 미충족

---

### 2.2 노출 대상 필터링

- [ ] 시작 시간이 이미 지난 정모 제외
- [ ] 중복 정모 제거 (정모 ID 기준)
- [ ] 동일 정모가 B 섹션 후보에 포함되더라도 A가 우선

---

### 2.3 정렬 규칙

- [ ] 시작일 오름차순
- [ ] 시작일 동일 시 시작 시간 오름차순
- [ ] tie 발생 시 최근 찜한 순

---

### 2.4 노출 개수 제한

- [ ] 최대 3개까지만 노출
- [ ] 4개 이상일 경우 상위 3개만 처음 노출, 이후 가로 스크롤

---

### 2.5 UI / CTA

<img src="../assets/mvp2/section-a-default.PNG" width="80%" />

- [ ] 정모 카드 클릭 시 모임의 해당 정모로 이동
- [ ] 하단 CTA 클릭 시 찜한 정모 리스트로 이동

---

## 3. B 섹션 — 같은 모임의 다른 정모 (마감된 정모 대체)

### 3.1 노출 조건 판단

- [ ] 사용자의 찜한 정모 중 `마감` 상태 정모 존재 여부 확인
  - [ ] 없음 → B 조건 미충족
- [ ] 마감된 찜 정모와 연결된 모임 수집
- [ ] 해당 모임에 정모 존재 여부 확인
  - [ ] 없음 → 해당 모임 제외
- [ ] 최종 후보 모임 존재 여부 확인
  - [ ] 존재 → B 조건 충족
  - [ ] 없음 → B 조건 미충족

---

### 3.2 대표 모임 선택 (초기)

- [ ] 후보 모임 1개 → 단일 표시
- [ ] 후보 모임 2개 이상
  - [ ] 가장 최근에 마감된 찜 정모의 모임 선택
  - [ ] tie 발생 시 최근 찜한 정모의 모임 우선

---

### 3.3 Hard Pin (모임 고정) 조건

아래 중 하나라도 충족 시 **세션 변경에도 모임 고정**:

- [ ] 해당 섹션 내 정모 카드 클릭 이력 존재
- [ ] 해당 섹션 내 모임 진입 이력 존재
- [ ] 최근 24~72시간동안 해당 섹션 내 동일 모임 노출 이력 존재
    - 이미 이 모임을 보여준 상태면, 갑자기 다른 모임으로 바꾸지 않는다.

---

### 3.4 Session Rotation 허용 여부

- [ ] Hard Pin 충족 → 로테이션 금지
- [ ] Hard Pin 미충족 → 세션 시작 시에만 로테이션 허용
- [ ] 같은 세션 내에서는 모임 변경 금지

---

### 3.5 로테이션 후보 풀 구성

- [ ] 후보 모임은 마감된 찜 정모와 직접 연결된 모임만 포함
- [ ] 후보 모임 최대 5개 제한
- [ ] 후보 정렬 기준
  - [ ] 최근 마감된 찜 정모 순
  - [ ] 최근 정모 생성 순

---

### 3.6 정모 리스트 구성 (단일 모임 기준)

- [ ] 선택된 대표 모임의 정모만 조회
- [ ] 예정된 정모만 포함
- [ ] 시작일 오름차순 정렬
- [ ] 정모는 **최대 4개까지 노출**
- [ ] 실제 정모 수가 4개 미만일 경우
  - [ ] 존재하는 정모만 노출
  - [ ] 빈 슬롯 / placeholder / skeleton 사용하지 않음
- [ ] 정모가 0개일 경우
  - [ ] B 섹션 전체 미노출
- [ ] 레이아웃, 카드 스타일, CTA 위치는 항상 동일하게 유지

---

### 3.7 UI / CTA

<img src="../assets/mvp2/section-b-list.jpg" width="80%" />

#### 찜 정모 더보기 CTA
- [ ] 노출 조건
  - [ ] 로테이션 후보 모임 수 < 2
- [ ] CTA 문구
  - [ ] `찜한 정모 더보기`
- [ ] CTA 위치
  - [ ] 정모 리스트 하단 고정
- [ ] 카드 개수와 무관하게 항상 동일한 위치 유지

#### 다른 모임 둘러보기 CTA
- [ ] 노출 조건
  - [ ] 로테이션 후보 모임 수 ≥ 2
- [ ] CTA 문구
  - [ ] `다른 모임 둘러보기`
  - [ ] (선택) 현재 인덱스/전체 `(1/5)`
- [ ] CTA 클릭 시
  - [ ] 다음 후보 모임 선택
  - [ ] 섹션 유지
  - [ ] 스크롤 위치 상단 리셋
  - [ ] Hard Pin 상태 초기화
- [ ] 자동 전환, 스크롤 중 전환 금지


---

## 4. A/B 충돌 및 배제 규칙

- [ ] A 조건 충족 시 B 섹션 계산 결과 무시
- [ ] A에 노출된 정모는 B 후보에서 제외
- [ ] 세션 중 A 조건 새로 충족되더라도

  - [ ] 현재 세션에서는 섹션 교체하지 않음
  - [ ] 다음 세션부터 적용

---

## 5. 빈 상태 처리

- [ ] A, B 모두 미충족 시

  - [ ] 찜 정모 관련 개인화 섹션 전체 미노출
  - [ ] 기본 홈 구성 유지
  - [ ] 안내/대체 문구 추가하지 않음

---

## 6. 로그 및 최소 추적

- [ ] GA, BQ: 참석/가입 성공 이벤트에 from_type만 추가

---

## 7. 공통 적용

### 정원이 꽉 찬 정모

<img src="../assets/mvp2/push-off-alert.PNG" width="80%" />


- [ ] 정원이 꽉 찬 정모 확인 누적 3번(같은 정모든 다른 정모든 상관X)인 시점에서, 시스템 알림 OFF인 사용자에게 최초 1번만 `알림 ON 제안 Alert` 표시
- [ ] 나중에 -> dismiss
- [ ] 알림 켜기 -> open system

---

## 8. 완료 기준 (Definition of Done)

- [ ] 홈에서 개인화 섹션이 최대 1개만 노출됨
- [ ] A 우선순위가 항상 보장됨
- [ ] B 로테이션이 세션 단위로만 발생
- [ ] 정모/모임 혼합 노출 없음
- [ ] 조건 미충족 시 홈이 비어 보이지 않음
